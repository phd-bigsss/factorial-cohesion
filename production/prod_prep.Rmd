---
title: "Preparación de datos"
date: "`r format(Sys.time(), '%A %d %B %Y %X')`"
output: 
  html_document: 
    toc: yes
    toc_float:
      collapsed: yes
      smooth_scroll: no
      number_sections: yes
    code_folding: show  
    number_sections: yes
editor_options: 
  chunk_output_type: console
---

# Setup

```{r setup}
knitr::opts_chunk$set(warning = FALSE, 
                      message = FALSE, 
                      echo = TRUE 
                      )
options(scipen=9999) # desactivar notacion cientifica
```

## Librerías

```{r}
if (!require("pacman")) install.packages("pacman") # instalar pacman
                            # cargar librerias
pacman::p_load(dplyr,       # Manipulacion de datos 
               haven,       # importar datos en .dta o .sav
               car,         # recodificar variables
               sjlabelled,  # etiquetado de variables
               sjmisc,      # descriptivos y frecuencias
               sjPlot,      # tablas, plots y descriptivos
               summarytools,# resumen de dataframe
               likert,
               ggplot2
               )
```

```{r}
df_wvs<- read_dta(here::here("input/data/original/WV6_Data_stata_v20201117.dta"))

df_CL <- 
df_wvs %>% 
  filter(V2==152) %>%
    select(V70,V73,V76,
         V74,V78,
         V71,V75,
         V77,V79,V72) %>% 
  sjlabelled::drop_labels(., drop.na = FALSE)

plot_likert(df_CL,title = "Chile, 2012",wrap.labels = 50) + theme(legend.position = "bottom")
ggsave(plot = last_plot(),filename = "fig_CL_values.png",device = "png",scale = 1:2,path = "output")

df_CL$openess <- (df_CL$V70+df_CL$V76)/3
df_CL$selftrans <- (df_CL$V76+df_CL$V74)/2
df_CL$selfimpro <- (df_CL$V71+df_CL$V75)/2
df_CL$conservation <- (df_CL$V77+df_CL$V79+df_CL$V72)/3
df_CL$country <- "Chile"


df_DE <- 
df_wvs %>% 
  filter(V2==276) %>%
  select(V70,V73,V76,
         V74,V78,
         V71,V75,
         V77,V79,V72) %>% 
  sjlabelled::drop_labels(., drop.na = FALSE)

plot_likert(df_DE,title = "Germany, 2012",wrap.labels = 50) + theme(legend.position = "bottom")
ggsave(plot = last_plot(),filename = "fig_DE_values.png",device = "png",scale = 1:2,path = "output")


df_DE$openess <- (df_DE$V70+df_DE$V76)/3
df_DE$selftrans <- (df_DE$V76+df_DE$V74)/2
df_DE$selfimpro <- (df_DE$V71+df_DE$V75)/2
df_DE$conservation <- (df_DE$V77+df_DE$V79+df_DE$V72)/3
df_DE$country <- "Germany"

summary(df_DE$openess)
summary(df_DE$selftrans)
summary(df_DE$selfimpro)
summary(df_DE$conservation)

df_CL_DE<- bind_rows(df_CL,df_DE)

df_CL_DE_country <- 
df_CL_DE %>% 
  group_by(country) %>% 
  summarise(m_openess=mean(openess,na.rm = T),
            m_selftrans=mean(selftrans,na.rm = T),
            m_selfimpro=mean(selfimpro,na.rm = T),
            m_conservation=mean(conservation,na.rm = T))

df_CL_DE<- left_join(df_CL_DE,df_CL_DE_country,by="country")
df_CL_DE %>% 
  select(openess:m_conservation) %>% 
  correlation::correlation(method = "spearman")


plot_openness <- ggplot(df_CL_DE, aes(x = openess, fill = country)) +
  geom_density(alpha = 0.5) +  # Adjust alpha for transparency
  labs(
    title = "Openness to change",
    x = "",
    y = "Openness"
  ) +
  theme_minimal() +  # Use a minimal theme
  scale_fill_brewer(palette = "Set2")  # Optional: Custom color palette

box_openness<- ggplot(df_CL_DE, aes(y = openess, fill = country)) +
  geom_boxplot() +
  labs(
    title = "Openness to change",
    y = "Openness to change"
  ) +
  theme_minimal() 

plot_selftrans <- ggplot(df_CL_DE, aes(x = selftrans, fill = country)) +
  geom_density(alpha = 0.5) +  # Adjust alpha for transparency
  labs(
    title = "Self-transcendence",
    x = "",
    y = "Self-transcendence"
  ) +
  theme_minimal() +  # Use a minimal theme
  scale_fill_brewer(palette = "Set2")  # Optional: Custom color palette

box_selftrans<- ggplot(df_CL_DE, aes(y = selftrans, fill = country)) +
  geom_boxplot() +
  labs(
    title = "Self-transcendence",
    y = "Self-transcendence"
  ) +
  theme_minimal() 


plot_selfimpro <- ggplot(df_CL_DE, aes(x = selfimpro, fill = country)) +
  geom_density(alpha = 0.5) +  # Adjust alpha for transparency
  labs(
    title = "Self-enhancement",
    x = "",
    y = "Self-enhancement"
  ) +
  theme_minimal() +  # Use a minimal theme
  scale_fill_brewer(palette = "Set2")  # Optional: Custom color palette

box_selfimpro<- ggplot(df_CL_DE, aes(y = selfimpro, fill = country)) +
  geom_boxplot() +
  labs(
    title = "Self-enhancement",
    y = "Self-enhancement"
  ) +
  theme_minimal() 


plot_conservation <- ggplot(df_CL_DE, aes(x = conservation, fill = country)) +
  geom_density(alpha = 0.5) +  # Adjust alpha for transparency
  labs(
    title = "Conservation",
    x = "",
    y = "Conservation"
  ) +
  theme_minimal() +  # Use a minimal theme
  scale_fill_brewer(palette = "Set2")  # Optional: Custom color palette

box_conservation<- ggplot(df_CL_DE, aes(y = conservation, fill = country)) +
  geom_boxplot() +
  labs(
    title = "Conservation",
    y = "Conservation"
  ) +
  theme_minimal() 

library(ggpubr)
# Arrange the plots using ggarrange
combined_plot <- ggarrange(
  plot_openness, plot_selftrans, plot_selfimpro, plot_conservation,
  ncol = 2, nrow = 2,  # 2 columns and 2 rows
  labels = c("A", "B", "C", "D")  # Optional labels
)


# Print the combined plot
print(combined_plot)


# Arrange the plots using ggarrange
combined_box <- ggarrange(
  box_openness, box_selftrans, box_selfimpro, box_conservation,
  ncol = 4, nrow = 1,  # 2 columns and 2 rows
  labels = c("A", "B", "C", "D")  # Optional labels
)

# Print the combined plot
print(combined_box)
```


Openness to change: "Making your own decisions (Self-Direction) and leading a fun and adventurous life (Stimulation)."

Self-transcendence: "Being tolerant (Benevolence) and helping the people around you (Universalism)"


Self-enhancement: "achieving personal success (Achievement) and being in charge (Power)" 

Conservation: "Feeling confident (Security), adapting to others (Comformity)and respecting traditions (Tradition)" 



*Openness to Change*

V70	Schwartz: It is important to this person to think up new ideas and be creative (Self-Direction)
V76	Schwartz: It is important to this person adventure and taking risks (Stimulation)

V73	Schwartz: It is important to this person to have a good time (Hedonism)


*Self-transcendence*

V74	Schwartz: It is important to this person to do something for the good of society (Benevolence)
V78	Schwartz: It is important to this person looking after the environment (Universalism)


*Self-enhancement*

V71	Schwartz: It is important to this person to be rich (Power)
V75	Schwartz: It is important to this person being very successful (Achievement)

*Conservation*

V77	Schwartz: It is important to this person to always behave properly (Comformity)
V79	Schwartz: It is important to this person tradition (Tradition)
V72	Schwartz: It is important to this person living in secure surroundings (Security)



